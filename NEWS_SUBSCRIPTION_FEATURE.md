# ๐ฐ ูุงุจูุช ุฏูุจุงู ฺฉุฑุฏู ุงุฎุจุงุฑ ุฎูุฏฺฉุงุฑ

## ๐ ุฎูุงุตู
ุงู ูุงุจูุช ุจู ฺฉุงุฑุจุฑุงู ุงุฌุงุฒู ูโุฏูุฏ ุชุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุณุฑุชุชุฑ ุขุฎุฑู ุงุฎุจุงุฑ ุฑูุฒ ุฑุง ุฏุฑ 3 ุฒูุงู ูุดุฎุต ุฏุฑุงูุช ฺฉููุฏ.

## โจ ูฺฺฏโูุง

### โฐ ุฒูุงูโุจูุฏ ุงุฑุณุงู
ุงุฎุจุงุฑ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุฏุฑ 3 ุฒูุงู ุจู ููุช ุงุฑุงู (Asia/Tehran) ุงุฑุณุงู ูโุดูุฏ:
- ๐ **ุตุจุฌ**: 8:00
- ๐ **ุธูุฑ**: 14:00 
- ๐ **ุดุจ**: 20:00

### ๐ฐ ูุญุชูุง
ุณุฑุชุชุฑ ุขุฎุฑู ุงุฎุจุงุฑ ุฑูุฒ ุงุฒ ููุจุน ูุนุชุจุฑ ูุงุฑุณ (ุชุณูู)

### โ ูุฒุงุง
- **ุฑุงฺฏุงู** ู **ุจุฏูู ูุญุฏูุฏุช**
- ุงูฺฉุงู ูุนุงู/ุบุฑูุนุงูโุณุงุฒ ุขุณุงู
- ุจูุงฺฉ ุฎูุฏฺฉุงุฑ ฺฉุงุฑุจุฑุงู ฺฉู ุฑุจุงุช ุฑุง ุจูุงฺฉ ฺฉุฑุฏูโุงูุฏ
- ฺฏุฒุงุฑุด ฺฉุงูู ุจู ุงุฏูู ูพุณ ุงุฒ ูุฑ ุงุฑุณุงู

## ๐๏ธ ุฌุฒุฆุงุช ูู

### ุชุบุฑุงุช ุฏุชุงุจุณ
ููุฏ ุฌุฏุฏ ุจู ุฌุฏูู `users` ุงุถุงูู ุดุฏ:
```sql
news_subscription_enabled INTEGER DEFAULT 0
```

### ุชูุงุจุน ุฌุฏุฏ ุฏุฑ `database.py`
- `enable_news_subscription(user_id)`: ูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ
- `disable_news_subscription(user_id)`: ุบุฑูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ
- `is_news_subscribed(user_id)`: ุจุฑุฑุณ ูุถุนุช ุงุดุชุฑุงฺฉ
- `get_news_subscribers()`: ุฏุฑุงูุช ูุณุช ูุดุชุฑฺฉุงู ูุนุงู

### ฺฉุจูุฑุฏโูุง ุฏุฑ `keyboards.py`
ฺฉุจูุฑุฏ ุจุฎุด ุนููู ุญุงูุง **ุฏุงูุงูฺฉ** ุงุณุช:
- ุงฺฏุฑ ฺฉุงุฑุจุฑ ูุดุชุฑฺฉ ูุจุงุดุฏ: ุฏฺฉูู "๐ฐ ุฏูุจุงู ฺฉุฑุฏู ุงุฎุจุงุฑ"
- ุงฺฏุฑ ฺฉุงุฑุจุฑ ูุดุชุฑฺฉ ุจุงุดุฏ: ุฏฺฉูู "๐ ูุบู ุงุดุชุฑุงฺฉ ุงุฎุจุงุฑ"

### Scheduler ุฏุฑ `telegram_bot.py`
ุงุฒ `APScheduler` ุจุง `AsyncIOScheduler` ุงุณุชูุงุฏู ุดุฏู:
```python
scheduler = AsyncIOScheduler(timezone=pytz.timezone('Asia/Tehran'))

scheduler.add_job(
    send_scheduled_news,
    trigger=CronTrigger(hour=8, minute=0, timezone='Asia/Tehran'),
    args=[application],
    id='morning_news'
)
# ... (ูุดุงุจู ุจุฑุง 14:00 ู 20:00)
```

### ุชุงุจุน ุงุฑุณุงู ุฎูุฏฺฉุงุฑ
`send_scheduled_news(context)` ุฏุฑ `telegram_bot.py`:
1. ุฏุฑุงูุช ูุณุช ูุดุชุฑฺฉุงู ูุนุงู
2. ุฏุฑุงูุช ุขุฎุฑู ุงุฎุจุงุฑ ุงุฒ API
3. ุงุฑุณุงู ุจุฑุง ูุฑ ูุดุชุฑฺฉ (ุจุง ุชุงุฎุฑ 50ms ุจุฑุง ุฌููฺฏุฑ ุงุฒ flood)
4. ุบุฑูุนุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ ุงุดุชุฑุงฺฉ ฺฉุงุฑุจุฑุงู ฺฉู ุฑุจุงุช ุฑุง ุจูุงฺฉ ฺฉุฑุฏูโุงูุฏ (Forbidden error)
5. ุงุฑุณุงู ฺฏุฒุงุฑุด ฺฉุงูู ุจู ุงุฏูู

### Handler ูุง
ุฏุฑ `telegram_bot.py`:
- `news_subscription_callback()`: ูุฏุฑุช callback query ุจุฑุง ุฏฺฉููโูุง ุชุงุฏ/ุงูุตุฑุงู
- Handler ุจุฑุง ุฏฺฉูู "๐ฐ ุฏูุจุงู ฺฉุฑุฏู ุงุฎุจุงุฑ" ุฏุฑ `fallback_handler`
- Handler ุจุฑุง ุฏฺฉูู "๐ ูุบู ุงุดุชุฑุงฺฉ ุงุฎุจุงุฑ" ุฏุฑ `fallback_handler`

## ๐ Migration
ุจุฑุง ุงุถุงูู ฺฉุฑุฏู ููุฏ ุฌุฏุฏ ุจู ุฏุชุงุจุณ ููุฌูุฏ:
```bash
python migrate_news_subscription.py
```

## ๐ค ุชุฌุฑุจู ฺฉุงุฑุจุฑ

### ูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ
1. ฺฉุงุฑุจุฑ ุจู ุจุฎุด ุนููู ูโุฑูุฏ
2. ุฑู "๐ฐ ุฏูุจุงู ฺฉุฑุฏู ุงุฎุจุงุฑ" ฺฉูฺฉ ูโฺฉูุฏ
3. ูพุงู ุชูุถุญ ุจุง ุฏฺฉููโูุง ุชุงุฏ/ุงูุตุฑุงู ููุงุด ุฏุงุฏู ูโุดูุฏ
4. ูพุณ ุงุฒ ุชุงุฏุ ุงุดุชุฑุงฺฉ ูุนุงู ู ุฏฺฉูู ุจู "๐ ูุบู ุงุดุชุฑุงฺฉ" ุชุบุฑ ูโฺฉูุฏ

### ุบุฑูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ
1. ฺฉุงุฑุจุฑ ุฑู "๐ ูุบู ุงุดุชุฑุงฺฉ ุงุฎุจุงุฑ" ฺฉูฺฉ ูโฺฉูุฏ
2. ุงุดุชุฑุงฺฉ ุบุฑูุนุงู ู ุฏฺฉูู ุจู "๐ฐ ุฏูุจุงู ฺฉุฑุฏู ุงุฎุจุงุฑ" ุชุบุฑ ูโฺฉูุฏ

## ๐ ฺฏุฒุงุฑุด ุจู ุงุฏูู
ูพุณ ุงุฒ ูุฑ ุจุงุฑ ุงุฑุณุงู ุฎูุฏฺฉุงุฑุ ฺฏุฒุงุฑุด ฺฉุงูู ุจุฑุง ุงุฏูู ุงุฑุณุงู ูโุดูุฏ ุดุงูู:
- โฐ ุฒูุงู ุงุฑุณุงู
- โ ุชุนุฏุงุฏ ูููู
- โ ุชุนุฏุงุฏ ูุงูููู
- ๐ฅ ุฌูุน ูุดุชุฑฺฉุงู ูุนุงู

## ๐ ูุงฺฏโฺฏุฑ
ุชูุงู ุนููุงุช ูุฑุจูุท ุจู ุงุดุชุฑุงฺฉ ุงุฎุจุงุฑ ูุงฺฏ ูโุดููุฏ:
- ูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ
- ุบุฑูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ
- ุงุฑุณุงู ุฎูุฏฺฉุงุฑ ุงุฎุจุงุฑ
- ุฎุทุงูุง ู ูุดฺฉูุงุช

## ๐ ุงููุช
- ููุท ฺฉุงุฑุจุฑุงู ุบุฑุจูุงฺฉ ุดุฏู ุงุฎุจุงุฑ ุฏุฑุงูุช ูโฺฉููุฏ
- ฺฉุงุฑุจุฑุงู ฺฉู ุฑุจุงุช ุฑุง ุจูุงฺฉ ฺฉููุฏุ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงุฒ ูุณุช ูุดุชุฑฺฉุงู ุญุฐู ูโุดููุฏ
- ุชุงุฎุฑ 50ms ุจู ุงุฑุณุงู ุจุฑุง ุฌููฺฏุฑ ุงุฒ Telegram Flood Limit

## ๐ ูุงูโูุง ุชุบุฑ ุงูุชู
1. `database.py` - ุชูุงุจุน ูุฏุฑุช ุงุดุชุฑุงฺฉ
2. `keyboards.py` - ฺฉุจูุฑุฏ ุฏุงูุงูฺฉ ุจุฎุด ุนููู
3. `telegram_bot.py` - ุชุงุจุน ุงุฑุณุงู ุฎูุฏฺฉุงุฑุ handler ูุงุ ู scheduler
4. `migrate_news_subscription.py` - ุงุณฺฉุฑูพุช migration

---

ููุณูุฏู: MiniMax Agent  
ุชุงุฑุฎ: 2025-10-22
