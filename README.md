# ربات تلگرام پیشرفته با پنل ادمین

این پروژه یک ربات تلگرام پیشرفته است که با استفاده از کتابخانه `python-telegram-bot` و دیتابیس SQLite ساخته شده است.

<!-- آخرین بروزرسانی: 2025-10-14 -->

## ویژگی‌های فعلی

### 🤖 عملکردهای اصلی:
- **دستور `/start`**: خوش‌آمدگویی هوشمند با ثبت کاربر
- **دستور `/help`**: راهنمای کامل و تعاملی
- **دستور `/status`**: نمایش وضعیت کامل ربات و کاربر
- **پردازش پیام‌ها**: دریافت و پردازش پیام‌های کاربران با لاگ کامل

### 👨‍💼 پنل مدیریت پیشرفته:
- **پنل ادمین شیشه‌ای**: رابط کاربری زیبا با InlineKeyboard
- **مدیریت سیستم**: مشاهده منابع، خاموش/روشن کردن ربات
- **مدیریت کاربران**: آمار، بلاک/انبلاک، جستجو
- **پیام همگانی**: ارسال پیام به تمام کاربران فعال
- **سیستم لاگ**: رصد کامل فعالیت‌ها

### 💾 سیستم دیتابیس:
- **SQLite Database**: ذخیره اطلاعات کاربران و تنظیمات
- **مدیریت کاربران**: ثبت خودکار و آمارگیری
- **سیستم لاگ**: ثبت تمام فعالیت‌ها و عملیات‌ها
- **تنظیمات ربات**: ذخیره و مدیریت تنظیمات

### 📊 آمارگیری و گزارش‌گیری:
- **آمار کاربران**: تعداد، وضعیت، فعالیت
- **آمار سیستم**: منابع، عملکرد، زمان اجرا
- **گزارش‌های تفصیلی**: آمار کامل و قابل صادرات

## تنظیمات

### اطلاعات ربات:
- **Token**: `1535325186:AAEWf9fPnJEW16ACEZEwmXIgbS2gZ5TGak8`
- **Admin User ID**: `327459477`

## نصب و راه‌اندازی

### 🏠 اجرای محلی (Development)

#### 1. پیش‌نیازها
- Python 3.9 یا بالاتر
- اتصال اینترنت پایدار
- Token ربات تلگرام از BotFather

#### 2. نصب وابستگی‌ها
```bash
pip install -r requirements.txt
```

#### 3. تنظیمات اولیه
فایل `.env` ایجاد کنید:
```env
BOT_TOKEN=1535325186:AAEWf9fPnJEW16ACEZEwmXIgbS2gZ5TGak8
ADMIN_USER_ID=327459477
ENVIRONMENT=development
```

#### 4. اجرای ربات
```bash
python telegram_bot.py
```

---

### 🚀 Deploy Production (توصیه شده)

#### 🎯 آماده برای Hosting
این ربات آماده deploy روی platform های رایگان است:

**✅ Platform های پشتیبانی شده:**
- **Railway** (512MB RAM رایگان)
- **Supabase** (500MB DB رایگان)
- **Heroku** (512MB RAM)
- **Render** (512MB RAM)

#### 📋 مراحل Deploy
```bash
1. 📁 GitHub Repository ایجاد کنید
2. 🗃️ Supabase Database تنظیم کنید
3. 🚂 Railway Hosting راه‌اندازی کنید
4. ⚡ Environment Variables تنظیم کنید
```

#### 📖 راهنمای کامل Deploy
برای مراحل تفصیلی deploy، فایل [`DEPLOYMENT_GUIDE.md`](./DEPLOYMENT_GUIDE.md) را مطالعه کنید.

**💰 هزینه:** رایگان تا محدودیت‌های platform

## ساختار پروژه

```
├── telegram_bot.py         # فایل اصلی ربات
├── database.py            # مدیریت دیتابیس SQLite 
├── database_postgres.py   # مدیریت دیتابیس PostgreSQL 🆕
├── admin_panel.py         # پنل مدیریت بهینه شده
├── logger_system.py       # سیستم لاگ پیشرفته
├── manage_logs.py         # ابزار مدیریت لاگ‌ها
├── user_management.py     # ماژول مدیریت کاربران
├── public_menu.py         # منوی عمومی کاربران
├── tradingview_analysis.py # تحلیل‌های TradingView 🆕
├── requirements.txt       # وابستگی‌های پروژه
├── runtime.txt           # نسخه Python برای deployment 🆕
├── Procfile              # تنظیمات Railway/Heroku 🆕
├── .env.example          # نمونه متغیرهای محیطی 🆕
├── .gitignore           # فایل‌های نادیده گرفته شده 🆕
├── DEPLOYMENT_GUIDE.md  # راهنمای کامل deploy 🆕
├── bot_database.db       # فایل دیتابیس (محلی)
├── logs/                 # پوشه فایل‌های لاگ
└── README.md            # راهنمای پروژه
```

### 🆕 ویژگی‌های Production-Ready:
- ✅ **Multi-Database Support**: SQLite (dev) + PostgreSQL (prod)
- ✅ **Environment Variables**: تنظیمات انعطاف‌پذیر
- ✅ **Cloud Deployment**: آماده Railway, Heroku, Render
- ✅ **Database Migration**: انتقال آسان به PostgreSQL
- ✅ **Auto-scaling**: connection pooling برای PostgreSQL

## نحوه استفاده

### برای کاربران عادی:
1. ربات را راه‌اندازی کنید
2. در تلگرام به ربات پیام `/start` بفرستید
3. از دستورات موجود استفاده کنید:
   - `/help` برای راهنمای کامل
   - `/status` برای وضعیت ربات و اطلاعات شما
   - ارسال هر پیام متنی برای پردازش

### برای ادمین:
1. استفاده از `/admin` برای دسترسی به پنل مدیریت
2. در پنل ادمین دسترسی به:
   - **🖥️ مدیریت سیستم**: منابع، وضعیت، خاموش/روشن
   - **👥 مدیریت کاربران**: آمار، بلاک/انبلاک، لیست
   - **📊 آمار کلی**: گزارش‌های تفصیلی
   - **📋 لاگ‌ها**: رصد فعالیت‌ها
   - **📢 پیام همگانی**: ارسال به همه کاربران
3. استفاده از `/broadcast` برای ارسال سریع پیام همگانی

## ویژگی‌های پنل ادمین

### 🖥️ مدیریت سیستم:
- **مشاهده منابع سیستم**: CPU، RAM، دیسک، شبکه
- **وضعیت ربات**: آمار کامل عملکرد
- **خاموش/روشن کردن**: کنترل دسترسی کاربران
- **لاگ‌های سیستم**: رصد خطاها و رویدادها

### 👥 مدیریت کاربران:
- **آمار تفصیلی**: تعداد، وضعیت، فعالیت
- **لیست کاربران**: مشاهده اطلاعات کامل
- **بلاک/انبلاک**: مدیریت دسترسی کاربران
- **کاربران بلاک شده**: مدیریت فهرست سیاه

### 📊 آمارگیری:
- **آمار لحظه‌ای**: وضعیت فعلی سیستم
- **آمار زمانی**: عضویت روزانه، هفتگی، ماهانه
- **آمار فعالیت**: پیام‌ها، کاربران فعال
- **نرخ‌ها**: فعالیت، بلاک، رشد

## مشکلات رایج

### ربات پاسخ نمی‌دهد:
- Token ربات را بررسی کنید
- مطمئن شوید ربات در تلگرام فعال است
- اتصال اینترنت را بررسی کنید
- وضعیت ربات را از پنل ادمین بررسی کنید

### خطای دسترسی:
- مطمئن شوید User ID ادمین صحیح است
- برای دستور `/admin` باید ادمین باشید
- اگر ربات غیرفعال است، فقط ادمین دسترسی دارد

### مشکلات دیتابیس:
- مطمئن شوید مجوزهای نوشتن روی پوشه وجود دارد
- فایل `bot_database.db` باید قابل نوشتن باشد
- در صورت خرابی، فایل دیتابیس را حذف کنید (دیتا از دست می‌رود)

### مشکلات عملکرد:
- برای تعداد زیاد کاربران، سرور قدرتمندتری نیاز است
- پیام همگانی ممکن است زمان‌بر باشد
- از Rate Limiting تلگرام آگاه باشید

## امکانات توسعه

### ویژگی‌های آماده برای اضافه کردن:
- ✅ سیستم کاربران کامل (پیاده‌سازی شده)
- ✅ پایگاه داده SQLite (پیاده‌سازی شده)
- ✅ پنل ادمین پیشرفته (پیاده‌سازی شده)
- ✅ سیستم لاگ و آمارگیری (پیاده‌سازی شده)
- ⏳ سیستم بک‌آپ دیتابیس
- ⏳ ارسال فایل و تصاویر
- ⏳ سیستم ticketing
- ⏳ اتصال به API های خارجی
- ⏳ سیستم پلاگین
- ⏳ رابط وب برای مدیریت

### توسعه‌های پیشنهادی:
1. **سیستم بک‌آپ خودکار**: پشتیبان‌گیری دوره‌ای از دیتابیس
2. **API خارجی**: اتصال به سرویس‌های مختلف
3. **سیستم اعلان‌ها**: اطلاع‌رسانی رویدادهای مهم
4. **پیام‌رسانی پیشرفته**: پشتیبانی از فایل، تصویر، ویدیو
5. **سیستم گروه‌بندی**: دسته‌بندی کاربران
6. **رابط وب**: پنل مدیریت تحت وب

## 🆕 سیستم لاگ پیشرفته

### ویژگی‌های جدید:
- **لاگ‌های جداگانه**: فایل‌های مختلف برای انواع لاگ
- **چرخش خودکار**: مدیریت اندازه فایل‌ها (10MB، 5 پشتیبان)
- **خلاصه خطاها**: آنالیز هوشمند خطاها
- **ابزار مدیریت**: اسکریپت تخصصی برای مدیریت لاگ‌ها

### فایل‌های لاگ:
```
logs/
├── bot_main.log         # لاگ‌های اصلی و عمومی
├── bot_errors.log       # خطاها با جزئیات کامل
├── bot_users.log        # عملیات کاربران
├── bot_admin.log        # عملیات ادمین
├── bot_system.log       # رویدادهای سیستم
└── bot_combined.log     # تمام لاگ‌ها در یک فایل
```

### استفاده از ابزار مدیریت:
```bash
# نمایش لاگ‌های اخیر
python manage_logs.py logs --category combined --lines 20

# خلاصه خطاها (24 ساعت اخیر)
python manage_logs.py errors --hours 24

# اطلاعات فایل‌های لاگ
python manage_logs.py files

# پاک کردن لاگ‌های قدیمی (30 روز)
python manage_logs.py cleanup --days 30
```

### در پنل ادمین:
- **📋 لاگ‌ها**: منوی کامل مدیریت لاگ‌ها
- **❌ خلاصه خطاها**: آنالیز خطاهای اخیر
- **📁 فایل‌های لاگ**: اطلاعات و آمار فایل‌ها

## 🎨 بهینه‌سازی پنل ادمین

### تغییرات جدید:
- ✅ **حذف دکمه‌های تکراری**: کاهش complexity و بهتر شدن UX
- ✅ **نمایش داینامیک**: آمار در خود دکمه‌ها (مثل تعداد کاربران)
- ✅ **کیبورد یکپارچه**: استفاده از توابع مشترک
- ✅ **منوی لاگ پیشرفته**: دسته‌بندی انواع لاگ‌ها

## مجوز

این پروژه تحت مجوز MIT ارائه شده است.
